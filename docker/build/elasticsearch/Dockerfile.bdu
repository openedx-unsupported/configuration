FROM us.icr.io/skills-network-portals/xenial-common:0.1.0-i.2

COPY . /edx/app/edx_ansible/edx_ansible

WORKDIR /edx/app/edx_ansible/edx_ansible/docker/plays
RUN /edx/app/edx_ansible/venvs/edx_ansible/bin/ansible-playbook \
      elasticsearch.yml \
      -i '127.0.0.1,' -c local \
      -t "install:base,install:app-requirements,install:configuration"

WORKDIR /
EXPOSE 9200 9300

ENTRYPOINT ["/usr/bin/dumb-init", "--"]
CMD ["/usr/share/elasticsearch/bin/elasticsearch", \
        "-Des.default.config=/edx/etc/elasticsearch/elasticsearch.yml", \
        "-Des.default.path.conf=/edx/etc/elasticsearch", \
        "-f"]
