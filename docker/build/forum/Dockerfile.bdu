FROM us.icr.io/skills-network-portals/xenial-common:0.1.0-i.2

COPY . /edx/app/edx_ansible/edx_ansible

WORKDIR /edx/app/edx_ansible/edx_ansible/docker/plays
RUN /edx/app/edx_ansible/venvs/edx_ansible/bin/ansible-playbook \
      forum.yml \
      -i '127.0.0.1,' -c local \
      -e@/edx/app/edx_ansible/edx_ansible/docker/build/forum/vars/build.yml \
      -e@/edx/app/edx_ansible/edx_ansible/docker/build/forum/vars/run.yml \
      -t "install:base,install:configuration,install:app-requirements,install:code"

WORKDIR /
EXPOSE 4567

ENTRYPOINT ["/edx/app/edx_ansible/edx_ansible/docker/build/forum/docker-run.sh"]

CMD ["/edx/app/supervisor/venvs/supervisor/bin/supervisord", \
      "--nodaemon", \
      "--configuration", "/edx/app/supervisor/supervisord.conf"]
