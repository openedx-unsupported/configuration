    - name: Update stage edge VPC
      ec2_vpc:
        state: present
        cidr_block: 10.5.0.0/16
        region: "{{ ec2_region }}"
        resource_tags: {"Name":"stage-edge","autostack":"true"}
        internet_gateway: True
        subnets:
          - cidr: 10.5.0.0/24
            az: us-east-1b
            resource_tags: {
              "autostack":"true","immutable_metadata":"{'purpose':'stage-edge-external','target':'ec2'}",
              }
          - cidr: 10.5.1.0/24
            az: us-east-1c
            resource_tags: {
              "immutable_metadata":"{'purpose':'stage-edge-external','target':'ec2'}","autostack":"true",
              }
          - cidr: 10.5.10.0/24
            az: us-east-1b
            resource_tags: {
              "Network":"Private","immutable_metadata":"{'purpose':'stage-edge-internal-edxapp','target':'ec2'}","play":"edxapp","autostack":"true",
              }
          - cidr: 10.5.11.0/24
            az: us-east-1c
            resource_tags: {
              "Network":"Private","play":"edxapp","immutable_metadata":"{'purpose':'stage-edge-internal-edxapp','target':'ec2'}","autostack":"true",
              }
          - cidr: 10.5.20.0/24
            az: us-east-1b
            resource_tags: {
              "autostack":"true","Network":"Private","immutable_metadata":"{'purpose':'stage-edge-internal-xserver','target':'ec2'}","play":"xserver",
              }
          - cidr: 10.5.21.0/24
            az: us-east-1c
            resource_tags: {
              "immutable_metadata":"{'purpose':'stage-edge-internal-xserver','target':'ec2'}","Network":"Private","autostack":"true","play":"xserver",
              }
          - cidr: 10.5.30.0/24
            az: us-east-1b
            resource_tags: {
              "Network":"Private","autostack":"true","immutable_metadata":"{'purpose':'stage-edge-internal-xqwatcher','target':'ec2'}","play":"xqwatcher",
              }
          - cidr: 10.5.31.0/24
            az: us-east-1c
            resource_tags: {
              "immutable_metadata":"{'purpose':'stage-edge-internal-xqwatcher','target':'ec2'}","Network":"Private","play":"xqwatcher","autostack":"true",
              }
          - cidr: 10.5.46.0/24
            az: us-east-1b
            resource_tags: {
              "autostack":"true","play":"commoncluster","immutable_metadata":"{'purpose':'stage-edge-internal-commoncluster','target':'ec2'}","Network":"Private",
              }
          - cidr: 10.5.47.0/24
            az: us-east-1c
            resource_tags: {
              "Network":"Private","immutable_metadata":"{'purpose':'stage-edge-internal-commoncluster','target':'ec2'}","play":"commoncluster","autostack":"true",
              }
          - cidr: 10.5.48.0/24
            az: us-east-1d
            resource_tags: {
              "autostack":"true","Network":"Private","play":"commoncluster","immutable_metadata":"{'purpose':'stage-edge-internal-commoncluster','target':'ec2'}",
              }
          - cidr: 10.5.50.0/24
            az: us-east-1b
            resource_tags: {
              "Application":"RDS","autostack":"true","Network":"Data",
              }
          - cidr: 10.5.51.0/24
            az: us-east-1c
            resource_tags: {
              "Application":"RDS","Network":"Data","autostack":"true",
              }
          - cidr: 10.5.60.0/24
            az: us-east-1b
            resource_tags: {
              "Application":"Elasticache","Network":"Cache","autostack":"true",
              }
          - cidr: 10.5.61.0/24
            az: us-east-1c
            resource_tags: {
              "Network":"Cache","autostack":"true","Application":"Elasticache",
              }
          - cidr: 10.5.70.0/24
            az: us-east-1b
            resource_tags: {
              "Network":"Private","immutable_metadata":"{'purpose':'stage-edge-internal-worker','target':'ec2'}","autostack":"true","play":"worker",
              }
          - cidr: 10.5.71.0/24
            az: us-east-1c
            resource_tags: {
              "Network":"Private","immutable_metadata":"{'purpose':'stage-edge-internal-worker','target':'ec2'}","play":"worker","autostack":"true",
              }
          - cidr: 10.5.80.0/24
            az: us-east-1b
            resource_tags: {
              "Network":"Private","autostack":"true","play":"forum","immutable_metadata":"{'purpose':'stage-edge-internal-forum','target':'ec2'}",
              }
          - cidr: 10.5.81.0/24
            az: us-east-1c
            resource_tags: {
              "play":"forum","immutable_metadata":"{'purpose':'stage-edge-internal-forum','target':'ec2'}","autostack":"true","Network":"Private",
              }
          - cidr: 10.5.90.0/24
            az: us-east-1b
            resource_tags: {
              "Application":"mongo","autostack":"true","immutable_metadata":"{'purpose':'stage-edge-internal-mongo','target':'ec2'}","Network":"Private",
              }
          - cidr: 10.5.91.0/24
            az: us-east-1c
            resource_tags: {
              "autostack":"true","Network":"Private","Application":"mongo","immutable_metadata":"{'purpose':'stage-edge-internal-mongo','target':'ec2'}",
              }
          - cidr: 10.5.92.0/24
            az: us-east-1d
            resource_tags: {
              "autostack":"true","Network":"Private","Application":"mongo","immutable_metadata":"{'purpose':'stage-edge-internal-mongo','target':'ec2'}",
              }
          - cidr: 10.5.100.0/24
            az: us-east-1b
            resource_tags: {
              "autostack":"true","immutable_metadata":"{'purpose':'stage-edge-internal-notifier','target':'ec2'}","play":"notifier","Network":"Private",
              }
          - cidr: 10.5.200.0/24
            az: us-east-1b
            resource_tags: {
              "Application":"admin","autostack":"true","Network":"Private",
              }
        route_tables:
          - subnets:
              - 10.5.0.0/24
              - 10.5.1.0/24
              - 10.5.10.0/24
              - 10.5.11.0/24
              - 10.5.20.0/24
              - 10.5.21.0/24
              - 10.5.30.0/24
              - 10.5.31.0/24
              - 10.5.46.0/24
              - 10.5.47.0/24
              - 10.5.48.0/24
              - 10.5.50.0/24
              - 10.5.51.0/24
              - 10.5.60.0/24
              - 10.5.61.0/24
              - 10.5.70.0/24
              - 10.5.71.0/24
              - 10.5.80.0/24
              - 10.5.81.0/24
              - 10.5.90.0/24
              - 10.5.91.0/24
              - 10.5.92.0/24
              - 10.5.100.0/24
              - 10.5.200.0/24
            routes:
              - dest: 10.5.0.0/16
                gw: local
              - dest: 0.0.0.0/0
                gw: i-81c7cda1
              - dest: 10.0.0.0/16
                gw: pcx-b907e1d0
              - dest: 18.4.102.0/24
                gw: vgw-3a29ca53
              - dest: 169.254.255.8/30
                gw: vgw-3a29ca53
              - dest: 169.254.255.12/30
                gw: vgw-3a29ca53
              - dest: 169.254.255.80/30
                gw: vgw-3a29ca53
              - dest: 169.254.255.84/30
po                gw: vgw-3a29ca53
              - dest: 169.254.255.88/30
                gw: vgw-3a29ca53
              - dest: 169.254.255.92/30
                gw: vgw-3a29ca53
          - subnets:
              - 10.5.0.0/24
              - 10.5.1.0/24
            routes:
              - dest: 10.5.0.0/16
                gw: local
              - dest: 0.0.0.0/0
                gw: igw-3ad3365f

      register: vpc
      tags:
        - "phase1"

    - name: debug
      debug:
        msg: "DEBUG: {{ vpc }}"
      tags:
        - "test"