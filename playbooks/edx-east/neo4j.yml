- name: Deploy neo4j for coursegraph
  hosts: all
  sudo: True
  gather_facts: True
  vars:
    CLUSTER_NAME: 'coursegraph'
    SPLUNKFORWARDER_LOG_ITEMS:
      - source: '/etc/neo4j/log/query.log'
        recursive: true
        index: 'testeng'
        sourcetype: coursegraph_query
        followSymlink: false

  roles:
    - role: nginx
      nginx_template_dir: "../roles/neo4j/templates/edx/app/nginx/sites-available"
      nginx_sites:
        - coursegraph
      nginx_default_sites:
        - coursegraph
#    - aws
    - neo4j
    - role: splunkforwarder
      when: COMMON_ENABLE_SPLUNKFORWARDER
