---
- hosts: tag_aws_cloudformation_stack-name_dev2:&tag_group_edxapp
  sudo: True
  vars_files:
    - "{{ secure_dir }}/vars/dev/dev2.yml"
    - "{{ secure_dir }}/vars/users.yml"
  roles:
    - common
    - nginx
    - role: 'edxapp'
      lms_nginx_port: 80
      cms_nginx_port: 80
      edxapp_lms_env: 'lms.envs.load_test'
- hosts: tag_aws_cloudformation_stack-name_dev2:&tag_group_xserver
  sudo: True
  vars_files:
    - "{{ secure_dir }}/vars/dev/dev2.yml"
    - "{{ secure_dir }}/vars/users.yml"
  roles:
    - common
    - nginx
    - xserver
- hosts: tag_aws_cloudformation_stack-name_dev2:&tag_group_rabbitmq
  serial: 1
  sudo: True
  vars_files:
    - "{{ secure_dir }}/vars/dev/dev2.yml"
    - "{{ secure_dir }}/vars/users.yml"
  roles:
    - common
    - rabbitmq
- hosts: tag_aws_cloudformation_stack-name_dev2:&tag_group_xqueue
  sudo: True
  vars_files:
    - "{{ secure_dir }}/vars/dev/dev2.yml"
    - "{{ secure_dir }}/vars/users.yml"
  roles:
    - common
    - nginx
    - xqueue
- hosts: tag_aws_cloudformation_stack-name_dev2:&tag_group_worker
  sudo: True
  vars_files:
    - "{{ secure_dir }}/vars/dev/dev2.yml"
    - "{{ secure_dir }}/vars/users.yml"
  roles:
    - common
    - nginx
    - { role: 'edxapp', celery_worker: True }
