---

- name: forum | create $forum_user user
  user: name=$forum_user state=present shell=/bin/bash home=$forum_home
  tags:
  - ruby
  - update

- include: ../../rbenv/tasks/main.yml

- name: forum | setup the forum env
  template: src=forum_env.j2 dest={{ ruby_base }}/forum_env owner={{ rbenv_user }} group={{ rbenv_user }}
  tags:
  - forum
  - update

- name: rbenv | ensure .bashrc exists
  shell: touch $ruby_base/.bashrc
  sudo: true  
  sudo_user: $rbenv_user 
  tags:
  - ruby
  - update

- name: rebenv | add source of ruby_env to .bashrc
  lineinfile:
    dest=$ruby_base/.bashrc
    regexp='. {{ruby_base}}/forum_env'    
    line='. {{ruby_base}}/forum_env'

- name: forum | copy cs_comments_service SysVunit script
  template: src=cs_comments_service.j2 dest=/etc/init.d/cs_comments_service owner=root group=root mode=750
  tags:
  - forum
  - install
  only_if: "'${ansible_distribution}' == 'Debian'"


- name: forum | copy cs_comments_service upstart script
  template: src=cs_comments_service.conf.j2 dest=/etc/init/cs_comments_service.conf owner=root group=root mode=750
  tags:
  - forum
  - install
  only_if: "'${ansible_distribution}' == 'Ubuntu'"

- include: deploy.yml
