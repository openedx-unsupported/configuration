---

#
# This role depends upon the rbenv role which needs to 
# be included in the same playbook prior to this role.
#

- name: forum | setup the forum env
  template: src=forum_env.j2 dest={{ forum_home }}/forum_env owner={{ forum_user }} group={{ forum_user }}
  tags:
  - forum
  - update

- name: forum | ensure .bashrc exists
  shell: touch {{ forum_home }}/.bashrc
  sudo: true  
  sudo_user: "{{ forum_user }}"
  tags:
  - forum
  - update

- name: forum | add source of ruby_env to .bashrc
  lineinfile:
    dest="{{ forum_home }}/.bashrc"
    regexp='. {{ forum_home }}/forum_env'    
    line='. {{ forum_home }}/forum_env'

- name: forum | copy cs_comments_service SysVunit script
  template: src=cs_comments_service.j2 dest=/etc/init.d/cs_comments_service owner=root group=root mode=750
  tags:
  - forum
  - install
  only_if: "'${ansible_distribution}' == 'Debian'"


- name: forum | copy cs_comments_service upstart script
  template: src=cs_comments_service.conf.j2 dest=/etc/init/cs_comments_service.conf owner=root group=root mode=750
  tags:
  - forum
  - install
  only_if: "'${ansible_distribution}' == 'Ubuntu'"

- include: deploy.yml
- include: test.yml