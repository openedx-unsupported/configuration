---
# create the 'edx' virtual environment in /opt so that roles can populate it
- name: common | Install python and pip
  apt: pkg={{item}} install_recommends=yes state=present update_cache=yes
  with_items:
  - python2.7
  - python-pip
  - python2.7-dev
  tags:
  - pre_install
  - install
  - virtualenv

- name: common | pip install virtualenv
  pip: name=virtualenv state=present
  tags:
  - venv_base
  - install
  - virtualenv

- name: common | pip install virtualenvwrapper
  pip: name=virtualenvwrapper state=present
  tags:
  - venv_base
  - install
  - virtualenv

- name: common | create edx virtualenv directory
  file: path={{ venv_dir }} owner=ubuntu group=adm mode=2775 state=directory
  tags:
  - venv_base
  - install
  - virtualenv

- name: common | create the edx virtualenv directory initial contents
  command: /usr/local/bin/virtualenv {{ venv_dir }} creates=$venv_dir/bin/activate
  tags:
  - venv_base
  - install
  - virtualenv

# install base pip packages for venv
- name: common | install base pip packages for venv
  shell: "{{venv_dir}}/bin/pip install {{item.pkg}}=={{item.version}}"
  with_items: common_base_pip_pkgs
  tags:
  - virtualenv
