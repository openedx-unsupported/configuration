---
- name: Install snort
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - snort
    - oinkmaster

- name: Configure snort and snort (debian)
  template:
    src: "etc/snort/{{ item.src }}"
    dest: "/etc/snort/{{ item.dest }}"
    owner: root
    group: root
    mode: "{{ item.mode }}"
  with_items:
    - { src: 'snort.conf.j2', dest: 'snort.conf', mode: '0644' }
    - { src: 'snort.debian.conf.j2', dest: 'snort.debian.conf', mode: '0644' }

- name: Configure oinkmaster and install oinkmaster cronjob
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: root
    group: root
    mode: "{{ item.mode }}"
  with_items:
    - { src: 'etc/oinkmaster.conf.j2', dest: '/etc/oinkmaster.conf', mode: '0644' }
    - { src: 'etc/cron.daily/oinkmaster.j2', dest: '/etc/cron.daily/oinkmaster', mode: '0755' }

- name: Update snort
  shell: "oinkmaster -C /etc/oinkmaster.conf -o /etc/snort/rules/"
  become: yes

- name: Snort service
  service:
    name: snort
    state: started

- name: Open read permissions on snort logs
  file:
    name: "/var/log/snort"
    state: directory
    mode: "0755"
