---
- set_fact:
    jenkins_credentials_root: '/tmp/credentials'
- set_fact:
    jenkins_credentials_file_dest: "{{ jenkins_credentials_root }}/credentials.json"
    jenkins_credentials_script: "{{ jenkins_credentials_root }}/addCredentials.groovy"

- name: create credentials dir
  file: name={{ jenkins_credentials_root }} state=directory

- name: upload groovy script
  template:
    src: addCredentials.groovy
    dest: "{{ jenkins_credentials_script }}"
    mode: "600"

- name: upload credentials file
  template:
    src: credentials_file.json
    dest: "{{ jenkins_credentials_file_dest }}"
    mode: "600"
    owner: "{{ jenkins_user }}"

- name: add credentials
  include: _execute_jenkins_cli.yaml
  vars:
    jenkins_command_string: "groovy {{ jenkins_credentials_script }}"

- name: clean up
  file: name={{ jenkins_credentials_root }} state=absent

