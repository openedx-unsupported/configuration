---
#
# edX Configuration
#
# github:     https://github.com/edx/configuration
# wiki:       https://openedx.atlassian.net/wiki/display/OpenOPS
# code style: https://openedx.atlassian.net/wiki/display/OpenOPS/Ansible+Code+Conventions
# license:    https://github.com/edx/configuration/blob/master/LICENSE.TXT
#
##
# Defaults for role discovery
#


#
# vars are namespace with the module name.
#
discovery_service_name: "discovery"
discovery_gunicorn_port: 8381

discovery_environment:
  DISCOVERY_CFG: "{{ COMMON_CFG_DIR }}/{{ discovery_service_name }}.yml"


#
# OS packages
#

discovery_debian_pkgs:
  - libxml2-dev
  - libxslt-dev
  - libjpeg-dev


DISCOVERY_NGINX_PORT: "1{{ discovery_gunicorn_port }}"
DISCOVERY_SSL_NGINX_PORT: "4{{ discovery_gunicorn_port }}"

DISCOVERY_DEFAULT_DB_NAME: 'discovery'
DISCOVERY_MYSQL: 'localhost'
# MySQL usernames are limited to 16 characters
DISCOVERY_MYSQL_USER: 'discov001'
DISCOVERY_MYSQL_PASSWORD: 'password'

# Using SSL? See https://www.elastic.co/guide/en/shield/current/ssl-tls.html.
# Using AWS? Use the AWS-provided host (e.g. https://search-test-abc123.us-east-1.es.amazonaws.com/).
# Assuming the port corresponds that of the protocol (e.g. http=80, https=443), there is no need to specify a port.
DISCOVERY_ELASTICSEARCH_URL: 'http://127.0.0.1:9200/'
DISCOVERY_ELASTICSEARCH_INDEX_NAME: 'catalog'

DISCOVERY_MEMCACHE: [ 'memcache' ]

DISCOVERY_VERSION: "master"
DISCOVERY_DJANGO_SETTINGS_MODULE: "course_discovery.settings.production"
DISCOVERY_URL_ROOT: 'http://discovery:{{ DISCOVERY_NGINX_PORT }}'
DISCOVERY_LOGOUT_URL: '{{ DISCOVERY_URL_ROOT }}/logout/'

DISCOVERY_SECRET_KEY: 'Your secret key here'
DISCOVERY_LANGUAGE_CODE: 'en-us'
DISCOVERY_DEFAULT_PARTNER_ID: 1

# Used to automatically configure OAuth2 Client
DISCOVERY_SOCIAL_AUTH_EDX_OIDC_KEY : 'discovery-key'
DISCOVERY_SOCIAL_AUTH_EDX_OIDC_SECRET : 'discovery-secret'
DISCOVERY_SOCIAL_AUTH_REDIRECT_IS_HTTPS: false

DISCOVERY_PLATFORM_NAME: 'Your Platform Name Here'

DISCOVERY_DATA_DIR: '{{ COMMON_DATA_DIR }}/{{ discovery_service_name }}'
DISCOVERY_MEDIA_ROOT: '{{ DISCOVERY_DATA_DIR }}/media'
DISCOVERY_MEDIA_URL: '/media/'

DISCOVERY_MEDIA_STORAGE_BACKEND:
  DEFAULT_FILE_STORAGE: 'django.core.files.storage.FileSystemStorage'
  MEDIA_ROOT: '{{ DISCOVERY_MEDIA_ROOT }}'
  MEDIA_URL: '{{ DISCOVERY_MEDIA_URL }}'

DISCOVERY_STATICFILES_STORAGE: 'django.contrib.staticfiles.storage.StaticFilesStorage'

# You can set different email backends with django:
# https://docs.djangoproject.com/en/1.9/topics/email/#email-backends
DISCOVERY_EMAIL_BACKEND: 'django_ses.SESBackend'

# For email backend django-ses, the following settings are required
DISCOVERY_AWS_SES_REGION_NAME: 'us-east-1'
DISCOVERY_AWS_SES_REGION_ENDPOINT: 'email.us-east-1.amazonaws.com'

# For default email backend SMTP, following settings are required
DISCOVERY_EMAIL_HOST: 'localhost'
DISCOVERY_EMAIL_PORT: 25
DISCOVERY_EMAIL_USE_TLS: False
DISCOVERY_EMAIL_HOST_USER: ''
DISCOVERY_EMAIL_HOST_PASSWORD: ''

DISCOVERY_PUBLISHER_FROM_EMAIL: 'None'

DISCOVERY_EXTRA_APPS: []

discovery_service_config_overrides:
  ELASTICSEARCH_URL: '{{ DISCOVERY_ELASTICSEARCH_URL }}'
  ELASTICSEARCH_INDEX_NAME: '{{ DISCOVERY_ELASTICSEARCH_INDEX_NAME }}'

  PLATFORM_NAME: '{{ DISCOVERY_PLATFORM_NAME }}'

  DEFAULT_PARTNER_ID: '{{ DISCOVERY_DEFAULT_PARTNER_ID }}'

  EMAIL_BACKEND: '{{ DISCOVERY_EMAIL_BACKEND }}'

  # Settings for django-ses email backend
  AWS_SES_REGION_NAME: '{{ DISCOVERY_AWS_SES_REGION_NAME }}'
  AWS_SES_REGION_ENDPOINT: '{{ DISCOVERY_AWS_SES_REGION_ENDPOINT }}'

  # Settings for default django SMTP email backend
  EMAIL_HOST: '{{ DISCOVERY_EMAIL_HOST }}'
  EMAIL_PORT: '{{ DISCOVERY_EMAIL_PORT }}'
  EMAIL_USE_TLS: '{{ DISCOVERY_EMAIL_USE_TLS }}'
  EMAIL_HOST_USER: '{{ DISCOVERY_EMAIL_HOST_USER }}'
  EMAIL_HOST_PASSWORD: '{{ DISCOVERY_EMAIL_HOST_PASSWORD }}'

  PUBLISHER_FROM_EMAIL: '{{ DISCOVERY_PUBLISHER_FROM_EMAIL }}'

# Vars that are used when the automated role is "mixed-in" via the deploying play
# This data structure specifies all the users with access to run command remotely
# over SSH and the fully qualified command that they can run via sudo to the
# application user

DISCOVERY_AUTOMATED_USERS:
  automated_user:
    sudo_commands:
      - command: "{{ discovery_venv_dir }}/python {{ discovery_home }}/{{ discovery_service_name }}/manage.py migrate --list"
        become_user: "discovery"
    authorized_keys:
      - "SSH authorized key"
