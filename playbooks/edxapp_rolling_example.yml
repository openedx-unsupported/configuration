# ansible-playbook -v --user=ubuntu  edxapp_rolling_example.yml -i ./ec2.py  --private-key=/path/to/deployment.pem --module-path /path/to/repo/modules
- hosts: tag_Group_anothermulti
  serial: 1
  vars_files:
    - "vars/secure/edxapp_stage_vars.yml"
    - "vars/secure/users.yml"
    - "vars/secure/edxapp_stage_users.yml"
  pre_tasks:
    - name: Gathering ec2 facts 
      ec2_facts: 
    - name: Gathering ELB facts
      local_action: ec2_elb_facts
    - local_action: command util/elb_reg.py -e {{ ",".join(elbs[ansible_ec2_instance_id]) }} -i {{ ansible_ec2_instance_id }} deregister
  roles:
    - common
    - nginx 
    - lms
  post_tasks:
    - local_action: command util/elb_reg.py -e {{ ",".join(elbs[ansible_ec2_instance_id]) }} -i {{ ansible_ec2_instance_id }} register
